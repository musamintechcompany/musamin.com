window.togglePasswordVisibility=function(e){const t=document.getElementById(e);if(!t)return;const n="passwordEye",s=t.type==="password";t.type=s?"text":"password",document.getElementById(`${n}Open`)?.classList.toggle("hidden",!s),document.getElementById(`${n}Pupil`)?.classList.toggle("hidden",!s),document.getElementById(`${n}Closed`)?.classList.toggle("hidden",s)};function d(e,t){document.querySelectorAll('[id$="Error"]').forEach(s=>s.classList.add("hidden")),document.getElementById("errorToast")?.classList.add("hidden");const n=o();return n.length?(t.preventDefault(),r(n),!1):(l(!0),!0)}function o(){const e=[],t={email:{value:document.getElementById("email")?.value.trim(),required:!0,validate:n=>/^\S+@\S+\.\S+$/.test(n)},password:{value:document.getElementById("password")?.value,required:!0}};return Object.entries(t).forEach(([n,s])=>{s.required&&!s.value?e.push({field:n,message:"This field is required"}):s.validate&&!s.validate(s.value)&&e.push({field:n,message:i(n)})}),e}function i(e){return{email:"Please enter a valid email",password:"Password is required"}[e]||"Invalid value"}function r(e){e.forEach(({field:t,message:n})=>{const s=document.getElementById(`${t}Error`);s&&(s.textContent=n,s.classList.remove("hidden"))}),a("Please correct the highlighted errors")}function l(e){document.getElementById("spinner")?.classList.toggle("hidden",!e);const t=document.getElementById("buttonText");t&&(t.textContent="Logging in..."),document.getElementById("loginBtn").disabled=e}function a(e){const t=document.getElementById("errorToast");t&&((e.toLowerCase().includes("csrf")||e.toLowerCase().includes("token mismatch")||e.toLowerCase().includes("419"))&&(e="Your session has expired. Please refresh the page and try again."),t.textContent=e,t.classList.remove("hidden"),t.classList.add("slide-down"),setTimeout(()=>{t.classList.remove("slide-down"),t.classList.add("hidden")},5e3))}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("loginForm");e&&e.addEventListener("submit",t=>{d(e,t)||t.preventDefault()})});
